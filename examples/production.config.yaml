# Production-Ready Configuration
# Includes TLS, monitoring, custom headers, and optimized timeouts

type: round-robin
port: 443
host: 0.0.0.0  # Listen on all interfaces for production

health_checker_time: 15s  # More frequent health checks in production

backends:
  - url: app-server-1.internal:8080
    health_check_path: /health
    max_conn: 1000  # Higher connection limit for production
    max_conn_timeout: 10s  # Faster timeout for production
    max_conn_duration: 60s  # Longer keep-alive for efficiency
    max_idle_conn_duration: 30s
    max_idemponent_call_attempts: 3

  - url: app-server-2.internal:8080
    health_check_path: /health
    max_conn: 1000
    max_conn_timeout: 10s
    max_conn_duration: 60s
    max_idle_conn_duration: 30s
    max_idemponent_call_attempts: 3

  - url: app-server-3.internal:8080
    health_check_path: /health
    max_conn: 1000
    max_conn_timeout: 10s
    max_conn_duration: 60s
    max_idle_conn_duration: 30s
    max_idemponent_call_attempts: 3

monitoring:
  port: 8001
  host: 127.0.0.1  # Only accessible from localhost for security

# Custom headers for tracing and debugging
custom_headers:
  x-forwarded-for: $remote_addr
  x-request-id: $uuid
  x-request-time: $time
  x-backend-counter: $incremental

server:
  http_version: http1
  cert_file: /etc/divisor/certs/server.crt
  key_file: /etc/divisor/certs/server.key

  # Production performance tuning
  concurrency: 524288  # Higher concurrency for production traffic
  max_idle_worker_duration: 30s
  tcp_keepalive_period: 60s

  # Prevent slow clients from holding connections
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
